{#
/**
 * @file
 * Default theme implementation to display a single page.
 *
 * The doctype, html, head and body tags are not in this template. Instead they
 * can be found in the html.html.twig template in this directory.
 *
 * Available variables:
 *
 * General utility variables:
 * - base_path: The base URL path of the Drupal installation. Will usually be
 *   "/" unless you have installed Drupal in a sub-directory.
 * - is_front: A flag indicating if the current page is the front page.
 * - logged_in: A flag indicating if the user is registered and signed in.
 * - is_admin: A flag indicating if the user has permission to access
 *   administration pages.
 *
 * Site identity:
 * - front_page: The URL of the front page. Use this instead of base_path when
 *   linking to the front page. This includes the language domain or prefix.
 *
 * Page content (in order of occurrence in the default page.html.twig):
 * - title_prefix: Additional output populated by modules, intended to be
 *   displayed in front of the main title tag that appears in the template.
 * - title: The page title, for use in the actual content.
 * - title_suffix: Additional output populated by modules, intended to be
 *   displayed after the main title tag that appears in the template.
 * - messages: Status and error messages. Should be displayed prominently.
 * - tabs: Tabs linking to any sub-pages beneath the current page (e.g., the
 *   view and edit tabs when displaying a node).
 * - node: Fully loaded node, if there is an automatically-loaded node
 *   associated with the page and the node ID is the second argument in the
 *   page's path (e.g. node/12345 and node/12345/revisions, but not
 *   comment/reply/12345).
 *
 * Regions:
 * - page.header: Items for the header region.
 * - page.navigation: Items for the navigation region.
 * - page.navigation_collapsible: Items for the navigation (collapsible) region.
 * - page.highlighted: Items for the highlighted content region.
 * - page.help: Dynamic help text, mostly for admin pages.
 * - page.content: The main content of the current page.
 * - page.sidebar_first: Items for the first sidebar.
 * - page.sidebar_second: Items for the second sidebar.
 * - page.footer: Items for the footer region.
 *
 * @ingroup templates
 *
 * @see template_preprocess_page()
 * @see html.html.twig
 */
#}


<section id="campaign" class="campaign">
  <header>
    <div class="vid-container">
      <video id="hea-vid" playsinline muted autoplay loop>
        <source src="{{ file_url(node.field_header_background_video.entity.uri.value) }}" type="video/mp4">
      </video>
    </div>
    <div class="hea-container">
      <h1><img src="{{ file_url(node.field_header_campaign_logo.entity.uri.value) }}" alt="{{ node.field_header_campaign_logo.alt }}" class="fgf-logo"></h1>
      <h2>{{ node.field_header_tagline.value }}</h2>
      <div class="mb-100"><a href="{{ node.field_header_cta_button.uri }}" class="btn-campaign" target="_blank">{{ node.field_header_cta_button.title }}</a></div>
      <div class="dt-logo-container"><img src="{{ file_url(node.field_header_dt_logo.entity.uri.value) }}" alt="{{ node.field_header_dt_logo.alt }}" class="dt-logo"></div>
    </div>
    <div id="down-arrow" class="down-arrow"><a href="#campaign-progress"><i class="glyphicon glyphicon-chevron-down"></i><span class="sr-only">Down arrow</span></a></div>
  </header>

  <section id="campaign-progress" class="campaign-progress">
    <h2>{{ node.field_campaign_progress_header.value }}</h2>
    <div class="campaign-progress-container">
      <div id="chart-container" class="chart-container">
        <div class="chart">
          <div class="circle"></div>
          <div class="semi-circle-wrapper"><div class="semi-circle"><div id="semi-circle-fill" class="semi-circle-fill"></div></div></div>
          <div class="progress-svg">
            <svg
              class="progress-ring"
              width="150"
              height="150">
              <circle
                class="progress-ring__circle"
                stroke="#84BD00"
                stroke-width="20"
                fill="transparent"
                r="65"
                cx="75"
                cy="75"/>
            </svg>
          </div>
          <!--<div class="progress-chart"></div>-->
          <div id="progress-text" class="progress-text">{{ node.field_campaign_progress_chart.value }}%</div>
        </div>
      </div>
      <div class="campaign-content-container">
        <h3>{{ node.field_campaign_progress_stat1.value }}</h3>
        <div class="campaign-content">{{ node.field_campaign_progress_stat1_su.value }}</div>
      </div>
      <div class="campaign-content-container">
        <h3>$<span id="count" class="count">{{ node.field_campaign_progress_stat2.value }}</span></h3>
        <div class="campaign-content">{{ node.field_campaign_progress_stat2_su.value }}</div>
      </div>
    </div>
  </section>

  {# begin news #}
  <section id="campaign-news" class="campaign-news">
    <div class="landing-page"><div class="lp-news-grid py-40">
        <section>
          <h2 class="cam-gray">Campaign News</h2>
          {{ page.content.views_block__news_search_block_5 }}
        </section></div></div>
  </section>

  <div class="clearfix mb-40"></div>
  {# end news #}

  <section id="campaign-goals" class="campaign-goals mx-15 mb-40">
    <h2 class="cam-gray">{{ node.field_campaign_goals_header.value }}</h2>
    <div class="campaign-goals-container py-40">
      <div class="campaign-goals-flex">
        <div class="campaign-goals-div mb-28">
          <h3>{{  node.field_campaign_goals_goal1.value }}</h3>
          <p>{{ node.field_campaign_goals_goal1_sub.value }}</p>
        </div>
        <div class="campaign-goals-arrow mb-28"><img src="/sites/default/files/images/arrow-icons.png" alt="Right arrow icon" class="campaign-arrow"></div>
        <div class="campaign-goals-div mb-28">
          <h3>{{ node.field_campaign_goals_goal2.value }}</h3>
          <p>{{ node.field_campaign_goals_goal2_sub.value }}</p>
        </div>
        <div class="campaign-goals-arrow mb-24"><img src="/sites/default/files/images/arrow-icons.png" alt="Right arrow icon" class="campaign-arrow"></div>
        <div class="campaign-goals-div">
          <h3 class="five-mil">{{ node.field_campaign_goals_goal3.value }}</h3>
          <p class="five-mil">{{ node.field_campaign_goals_goal3_sub.value }}</p>
        </div>
      </div>
      <div class="triple-tri-wrapper">
        <div class="triple-tri"></div>
      </div>
    </div>
  </section>

  <section id="expand-student-support" class="expand-student-support mb-40">
    <div class="feature mb-40" style="background-image: url({{ file_url(node.field_content1_image.entity.uri.value) }});">
      <!--<img src="pho-chapel-hill-tire.jpg" alt="">-->
      <div class="feature-quote">
        <div class="feature-quote-content">{{ node.field_content1_quote.value|raw }}</div>
        <div class="feature-quote-by"><strong class="txt-uc">{{ node.field_content1_quote_name.value }}</strong> | {{ node.field_content1_quote_title.value }}<br>{{ node.field_content_area1_quote_title2.value }}</div>
      </div>
    </div>
    <div class="expand-content">
      <h2 class="cam-gray">{{ node.field_content1_header.value }}</h2>
      {{ node.field_content1_content.value|raw }}
    </div>
  </section>

  <section id="forge-tomorrows-workforce" class="forge-tomorrows-workforce pb-40 mb-40">
    <div class="feature" style="background-image: url({{ file_url(node.field_content2_image.entity.uri.value) }});">
      <!--<img src="pho-forge-tomorrows-workforce.jpg" alt="">-->
      <div class="feature-quote">
        <div class="feature-quote-content">{{ node.field_content2_quote.value|raw }}</div>
        <div class="feature-quote-by"><strong class="txt-uc">{{ node.field_content2_quote_name.value }}</strong> | {{ node.field_content2_quote_title.value }}<br>{{ node.field_content_area2_quote_title2.value }}</div>
      </div>
    </div>
    <div class="forge-content-wrapper">
      <div class="forge-stats-wrapper">
        <div class="forge-stats">
          <div class="forge-stats-number">{{ node.field_content2_stat1.value }}</div>
          <div class="forge-stats-content mb-40">{{ node.field_content2_stat1_sub.value }}</div>
          <div class="forge-stats-number">{{ node.field_content2_stat2.value }}</div>
          <div class="forge-stats-content">{{ node.field_content2_stat2_sub.value }}</div>
        </div>
      </div>
      <div class="forge-content">
        <h2>{{ node.field_content2_header.value }}</h2>
        {{ node.field_content2_content.value|raw }}
      </div>
    </div>
  </section>

  <section id="your-gift-ways-to-give" class="your-gift-ways-to-give">
    <div id="your-gift" class="your-gift">
      <h2 class="cam-gray">{{ node.field_your_gift_header.value }}</h2>
      {{ node.field_your_gift_content.value|raw }}
      <div><a href="{{ node.field_your_gift_cta_button.uri }}" class="btn-campaign" target="_blank">{{ node.field_your_gift_cta_button.title }}</a></div>
    </div>
    <div id="ways-to-give" class="ways-to-give">
      <h2 class="cam-gray">{{ node.field_ways_to_give_header.value }}</h2>
      {{ node.field_ways_to_give_content.value|raw }}
    </div>
  </section>

  <section id="presidents-message" class="presidents-message mb-40">
    <div class="pres-content-wrapper">
      <div class="pres-pho" style="background-image: url({{ file_url(node.field_content3_image.entity.uri.value) }});"></div>
      <div class="pres-content">
        <h2>{{ node.field_content3_header.value }}</h2>
        {{ node.field_content3_content.value|raw }}
      </div>
    </div>
  </section>

  <section id="student-testimonials" class="student-testimonials mb-40">
    <div class="student-cards">
      <div class="student1">
        <div class="student1-pho" style="background-image: url({{ file_url(node.field_student1_image.entity.uri.value) }});"></div>
        <div class="student-content">
          {{ node.field_student1_quote.value|raw }}
          <div class="quote-source">
            <strong class="txt-uc">{{ node.field_student1_quote_name.value }}</strong> | {{ node.field_student1_quote_title.value }}<br>{{ node.field_student1_quote_title2.value }}
          </div>
        </div>
      </div>
    </div>

    <div class="student-cards">
      <div class="student2">
        <div class="student2-pho" style="background-image: url({{ file_url(node.field_student2_image.entity.uri.value) }});"></div>
        <div class="student-content">
          {{ node.field_student2_quote.value|raw }}
          <div class="quote-source my-20 pr-20">
            <strong class="txt-uc">{{ node.field_student2_quote_name.value }}</strong> | {{ node.field_student2_quote_title.value }}<br>{{ node.field_student2_quote_title2.value }}
          </div>
        </div>
      </div>
    </div>

    <div class="student-cards">
      <div class="student3">
        <div class="student3-pho" style="background-image: url({{ file_url(node.field_student3_image.entity.uri.value) }});"></div>
        <div class="student-content">
          {{ node.field_student3_quote.value|raw }}
          <div class="quote-source my-20 pr-20">
            <strong class="txt-uc">{{ node.field_student3_quote_name.value }}</strong> | {{ node.field_student3_quote_title.value }}<br>{{ node.field_student3_quote_title2.value }}
          </div>
        </div>
      </div>
    </div>
  </section>


  <footer class="padding-40">
    <div class="foo-content-wrapper container">
      <div class="foo-logos">
        <div><img src="{{ file_url(node.field_header_campaign_logo.entity.uri.value) }}" alt="{{ node.field_header_campaign_logo.alt }}" class="fgf-logo-foo mb-28"></div>
        <div><img src="{{ file_url(node.field_header_dt_logo.entity.uri.value) }}" alt="{{ node.field_header_dt_logo.alt }}" class="dt-logo-foo mb-28"></div>
      </div>
      <nav id="block-footercolumn1" class="contextual-region">
        <ul class="menu nav footer-column-1">
          <li>
            <a href="https://www.durhamtech.edu">Durham Tech Website</a>
          </li>
          <li>
            <a href="https://www.durhamtech.edu/durham-tech-foundation">Durham Tech Foundation</a>
          </li>
          <li>
            <a href="https://www.durhamtech.edu/durham-tech-foundation/our-impact">Our Impact</a>
          </li>
          <li>
            <a href="https://dtcc46085.thankyou4caring.org/">Donate Now</a>
          </li>
        </ul>
      </nav>
      <nav id="block-footercolumn2" class="contextual-region">
        <ul class="menu nav footer-column-2">
          <li>
            <a href="https://www.durhamtech.edu/about-durham-tech/mission-vision-and-values">Strategic Plan</a>
          </li>
          <li>
            <a href="#">Campaign News</a>
          </li>
          <li>
            <a href="https://www.durhamtech.edu/pay-college/scholarships">Student Scholarships</a>
          </li>
          <li>
            <a href="https://www.durhamtech.edu/about-durham-tech/leadership-and-administration">Leadership & Administration</a>
          </li>
        </ul>
      </nav>

    </div>
  </footer>

</section>


{% if page.footer %}
  {% block footer %}
    <footer class="footer" role="contentinfo">
      {#<div class="footer-top container">
        <div class="row">
          {{ page.footer }}
        </div>
      </div>#}
      <div class="footer-bottom">
        <div class="container">
          <div class="row">
            <div class="col-sm-6 footer-bottom-menu bottom-footer-menu-placeholder">
              {{ page.footer_bottom }}
            </div>
            <div class="col-sm-6 footer-bottom-social bottom-footer-social-placeholder">
              {{ page.footer_bottom_2 }}
            </div>
          </div>
        </div>
      </div>
    </footer>
  {% endblock %}
{% endif %}



<script>

  var callback = function(){
    // Handler when the DOM is fully loaded

    var prog = {{ node.field_campaign_progress_stat2.value }};
    var perc = Math.floor((prog / 5000000) * 100);

    var ch = document.getElementById('chart-container');
    var isInViewport = function (elem) {
      var bounding = elem.getBoundingClientRect();
      return (
        bounding.top >= 0 &&
        bounding.left >= 0 &&
        bounding.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
        bounding.right <= (window.innerWidth || document.documentElement.clientWidth)
      );
    };

    var circle = document.querySelector('circle');
    var radius = circle.r.baseVal.value;
    var circumference = radius * 2 * Math.PI;

    circle.style.strokeDasharray = `${circumference} ${circumference}`;
    circle.style.strokeDashoffset = `${circumference}`;

    const offset = circumference - 0 / 100 * circumference;
    circle.style.strokeDashoffset = offset;

    function setProgress(percent) {
      circle.style.visibility = 'visible';
      circle.style.transition = '3.0s stroke-dashoffset';
      const offset = circumference - percent / 100 * circumference;
      circle.style.strokeDashoffset = offset;
    }

    // begin vid pause
    var vid = document.getElementById("hea-vid");
    window.addEventListener('scroll', function (event) {
      if (isInViewport(vid)) {
        vid.play();
      } else {
        vid.pause();
      }
    }, false);


    if (isInViewport(vid)) {
      vid.play();
    } else {
      vid.pause();
    }
    // end vid pause

    window.addEventListener('scroll', function (event) {
      if (isInViewport(ch)) {
        window.removeEventListener('scroll', arguments.callee);
        animateValue("count", 0, prog, 3000);
        animateValue("progress-text", 0, perc, 3000);
        setProgress(perc);
        var scFill = document.getElementById("semi-circle-fill");
        scFill.style.height = perc + "%";
      }
    }, false);

    if (isInViewport(ch)) {
      window.removeEventListener('scroll', arguments.callee);
      animateValue("count", 0, prog, 3000);
      animateValue("progress-text", 0, perc, 3000);
      setProgress(perc);
      var scFill = document.getElementById("semi-circle-fill");
      scFill.style.height = perc + "%";
    }

    function animateValue(id, start, end, duration) {
      // assumes integer values for start and end
      var obj = document.getElementById(id);
      var range = end - start;
      // no timer shorter than 50ms (not really visible any way)
      var minTimer = 50;
      // calc step time to show all interediate values
      var stepTime = Math.abs(Math.floor(duration / range));

      // never go below minTimer
      stepTime = Math.max(stepTime, minTimer);

      // get current time and calculate desired end time
      var startTime = new Date().getTime();
      var endTime = startTime + duration;
      var timer;

      function run() {
        var now = new Date().getTime();
        var remaining = Math.max((endTime - now) / duration, 0);
        var value = Math.round(end - (remaining * range));
        value = commaSeparateNumber(value);
        if (id == "progress-text") {
          value = value + "%";
        }
        obj.innerHTML = value;
        if (value == end) {
          clearInterval(timer);
        }
      }

      timer = setInterval(run, stepTime);
      run();
    }

    function commaSeparateNumber(val) {
      while (/(\d+)(\d{3})/.test(val.toString())) {
        val = val.toString().replace(/(\d+)(\d{3})/, '$1' + ',' + '$2');
      }
      return val;
    }
  };

  if (
    document.readyState === "complete" ||
    (document.readyState !== "loading" && !document.documentElement.doScroll)
  ) {
    callback();
  } else {
    document.addEventListener("DOMContentLoaded", callback);
  }

</script>
